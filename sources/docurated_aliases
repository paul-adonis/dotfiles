# ============ Docurated Aliases =============
DOC_HOME='/Users/sampaul/Development/Docurated'


# ===== JIRA ZSH Plugin / URLs ========
JIRA_URL='https://docurated.atlassian.net'
GITHUB_URL='https://github.com/Docurated'
JENKINS_URL='https://jenkins.service.consul'
HANGOUTS_URL='https://hangouts.google.com/hangouts'


# ===== GOOGLE HANGOUTS ========
openHangout() { open "$HANGOUTS_URL/_/docurated.com/$1?authuser=$2" }
alias relho='openHangout relevance sam@docurated.com'
alias relno='open "https://docs.google.com/a/docurated.com/document/d/1ktuCdngDhUZxfd5-uND9jC23_l9SzQiCkLMC2RU0zzg/edit?usp=sharing"'


# ===== GIT REPOS ========
alias docweb='cd $DOC_HOME/website/rails && rvmgd'
alias docutil='cd $DOC_HOME/utilities && rvmgdu'
alias doccli='cd $DOC_HOME/clients && rvmgdu'
alias docserv='cd $DOC_HOME/services'
alias docevents='cd $DOC_HOME/events'
alias docact='cd $DOC_HOME/activity && rvm use gemset 2.2.5@activity'

alias hubc='open $GITHUB_URL/clients'
alias hubw='open $GITHUB_URL/website'
alias hubu='open $GITHUB_URL/utilities'
alias hubs='open $GITHUB_URL/services'
alias hube='open $GITHUB_URL/events'
alias huba='open $GITHUB_URL/activity'

searchgit() { open "https://github.com/Docurated/$1/search?utf8=âœ“&q=$2" }
alias hubcs='searchgit clients'
alias hubws='searchgit website'
alias hubus='searchgit utilities'
alias hubss='searchgit services'
alias hubes='searchgit events'
alias hubas='searchgit activity'


# ===== JENKINS ========
alias jenk='open $JENKINS_URL/'
alias jenkc='open $JENKINS_URL/job/Client%20Build/'
alias jenks='open $JENKINS_URL/job/BuildTestDeployWebStage/'
alias jenkw='open $JENKINS_URL/job/BuildTestDeployWebMaster/'
alias jenke='open $JENKINS_URL/job/Events%20Build/'
alias jenka='open $JENKINS_URL/job/Activity/'


# ===== DOCFORMATION/DOCCONNECTION (soon to be deprecated) ========
alias con='docutil && $DOC_HOME/utilities/docformation/docconnection.rb'
alias cupdate='docutil && $DOC_HOME/utilities/docformation/docconnection.rb update'

docconnect() {
    cd $DOC_HOME/utilities/docformation
    rvm gemset use docurated_util
    $DOC_HOME/utilities/docformation/docconnection.rb $1.$2.$3
}

alias tag='$DOC_HOME/utilities/docformation/docformation.rb tag_release --repo='

taillog() {
    cd $DOC_HOME/utilities/docformation
    rvm gemset use docurated_util
    lines=100
    N=${2:-$lines}
    ./docconnection.rb $1.web "tail -n $N /mnt/app/website/rails/log/$1.log"
}
alias taild='taillog demo'
alias tailp='taillog production'


# ===== SSH ========
sshconnect() { ssh $1.$2.$3 }

alias cdweb='sshconnect demo web'
alias cdapi='sshconnect demo api'
alias cdrapp='sshconnect demo railsapp'
alias cdev='sshconnect demo events'
alias cdcass='sshconnect demo cassandra'
# alias cdact='sshconnect demo activity'


alias cpweb='sshconnect production web'
alias cpapi='sshconnect production api'
alias cprapp_old='sshconnect production railsapp'
alias cpev='sshconnect production events'
alias cpcass='sshconnect production cassandra'
alias cprapp='docutil && $DOC_HOME/utilities/bin/ssh-first production resque'

alias cdpost='ssh demo.postgres.0 -L 5434:localhost:5432'
alias cppost='ssh production.postgres.0 -L 5435:localhost:5432'
alias cbpost='ssh biomarin.postgres.0 -L 5436:localhost:5432'

alias dpql='psql -w -h localhost -p 5434 -U rails docurated'
alias ppql='psql -w -h localhost -p 5435 -U rails docurated'
alias bpql='psql -w -h localhost -p 5436 -U rails docurated'

alias cdact='ssh demo.activity.0 -L 8286:localhost:8282 -L 5436:activity-demo.cpk5zbekyq7f.us-east-1.rds.amazonaws.com:5432 -L 5439:analytics-demo.cpk5zbekyq7f.us-east-1.rds.amazonaws.com:5432'
alias cpact='ssh production.activity.0 -L 8287:localhost:8282 -L 5437:activity-production.cpk5zbekyq7f.us-east-1.rds.amazonaws.com:5432 -L 5440:analytics-production.cpk5zbekyq7f.us-east-1.rds.amazonaws.com:5432'
alias cbact='ssh biomarin.activity.0 -L 8288:localhost:8282 -L 5438:activity-biomarin.cr9ikdrfc2gy.us-west-2.rds.amazonaws.com:5432 -L 5441:analytics-biomarin.cr9ikdrfc2gy.us-west-2.rds.amazonaws.com:5432'

alias dpqlact='psql -w -h localhost -p 5436 -U activitydemo activity'
alias ppqlact='psql -w -h localhost -p 5437 -U activityproduction activity'
alias bpqlact='psql -w -h localhost -p 5438 -U activitybiomarin activity'

alias dpqlana='psql -w -h localhost -p 5439 -U analyticsdemo analytics'
alias ppqlana='psql -w -h localhost -p 5440 -U analyticsproduction analytics'
alias bpqlana='psql -w -h localhost -p 5441 -U analyticsbiomarin analytics'

alias dcql='cdcass 0 && cqlsh'
alias pcql='cqlsh production.cassandra.0'

alias cadmin='sshconnect production admin'
alias cchef='docutil && $DOC_HOME/utilities/docformation/docconnection.rb chef.workstation'
# postgres
alias pql='psql -d docurated -p 5432'

# reset the stupid mac osx DNS for tunnelblick to work
alias resetdns='sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist && sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist'

# ===== CLIENT APP ========
setDemoVersion() {
    cd $DOC_HOME/clients/deploy
    rm client_demo_version.txt
    touch client_demo_version.txt
    echo $1 > client_demo_version.txt
    s3cmd put client_demo_version.txt s3://docurated-private/client_demo_version.txt
}

alias pd='doccli && python docurated.py'
alias pyserv='doccli && python -m SimpleHTTPServer'
alias coffserv='doccli && cd browser && coffee --watch --compile --output lib/ src/'
# alias cliserv='doccli && pyserv'
# alias cliserv='doccli && cd browser && coffserv'
alias clogd='doccli && tail -f app.log'
alias clog='tail -f ~/.docurated/app.log'
alias mount_vol='sudo mount -t smbfs //Guest@50.17.45.211/vol /private/nfs'
alias msd='sudo mount -t smbfs //Guest@50.17.45.211/vol /private/nfs'


# ===== RAILS ========
alias rvmgd='rvm use 2.2.5@docurated'
alias rvmgdu='rvm gemset use docurated_util'
alias rs='rails s'
alias rc='rails c'
alias rsp='rails s -p '
alias rcd='docweb && rails c development'
alias rsd='docweb && thin start --ssl --ssl-verify --ssl-key-file ~/Development/server.key --ssl-cert-file ~/Development/server.crt'
alias wlog='docweb && tail -f log/development.log'


# ===== SOLR ========
alias solrsold='cd $DOC_HOME/website/rails/opt/solr/jetty && java -Dsolr.solr.home=docu -jar start.jar'
alias solrs='cd /opt/solr/solr-4.*/example && java -jar start.jar'
alias solrsnew='/opt/solr/solr-4.*/bin/solr start -s /opt/solr/cores'
alias testsolrs='docweb && bundle exec sunspot-solr start -p 8984'
alias testsolrr='docweb && bundle exec sunspot-solr run -p 8984'


# ===== WORKERS ========
alias resqd='open https://demosecure.docurated.com/site/resque/overview'
alias resqp='open https://admin.docurated.com/site/resque/overview'

alias start_resqs='docweb && resque-scheduler --environment development &'
alias start_resqp='docweb && resque-pool --environment development &'
alias start_sidekiq='docweb && RAILS_ENV=development sh bin/sidekiq.sh start &'

alias stop_resqs='pkill -f "resque-scheduler"'
alias stop_resqp='pkill -f "resque-pool-master"'
alias stop_sidekiq='docweb && RAILS_ENV=development sh bin/sidekiq.sh stop'

alias start_workers='start_resqs; start_resqp; start_sidekiq'
alias stop_workers='stop_resqs; stop_resqp; stop_sidekiq'

alias start_dynamo='cd ~/dynamo && nohup java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -inMemory -port 8888 > ~/dynamoout.txt 2> ~/dynamoerr.text < /dev/null &'
alias start_services='cd $DOC_HOME/services/javaworker && ./gradlew -Denv=development master:run'

alias start_all='pstarts; testsolrs; start_dynamo; solrs &'
alias start_cli='pyserv &; coffserv &; doccli; mount_vol'

alias dresq='docutil && docformation/docconnection.rb demo.railsapp "ps -ef f | grep resque"'
alias sresq='docutil && docformation/docconnection.rb stage.railsapp "ps -ef f | grep resque"'


